## 黑名单设置
- 通过 `blackListSet` 列出不可访问的全局对象（如 document、fetch）
- 在沙箱中访问这些对象时返回一个黑洞代理，避免报错

```js
const blackListSet = new Set([
  'top',
  'self',
  'parent',
  'global',
  'globalThis'
  'document',
  'fetch',
  'window',
  'frames',
  'XMLHttpRequest',
  'MutationObserver',
]);
```

## 黑洞代理
- 任何对黑名单对象的访问，都会返回一个虚拟的“黑洞对象”
- 黑洞对象会吞掉任何访问或调用，而不会抛出异常

```ts
function createBlackHole() {
  return new Proxy(
    function () {
      return createBlackHole();
    },
    {
      get(_, p) {
        if (p === 'toString' || p === Symbol.toPrimitive) {
          return createBlackHole();
        }
      },
    }
  )
}
```

## 沙箱代理
- 使用 `Proxy` 创建沙箱对象，拦截用户代码对全局对象的访问。
- 对于黑名单对象，返回黑洞代理；对于正常对象，返回真实值或绑定后的函数。

```ts
function createMockWindow(base?: object) {
  const win: any = new Proxy(Object.assign({}, base), {
    get(target, p) {
      if (globalVarNames.has(p)) return win;
      if (blackListSet.has(p as string)) return createBlackHole();
      return Reflect.get(window, p);
    }
  })
  return win;
}
```

## 沙箱运行代码
- 使用 `with` 语句注入沙箱对象，将用户代码与沙箱隔离。
- 通过严格模式（'use strict'）防止意外的全局变量泄漏。

```ts
function runUsersCode(code: string) {
  const finalCode = `with(this) {

    return (function() {
      'use strict';
      return (${code});
      }).call(this);
  }`
  return new Function(finalCode);
}
```