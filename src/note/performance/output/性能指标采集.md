上文讲了我们应该关注什么样的前端指标指标，本篇讲如何采集这些指标


常见的前端指标有 `FP`、`FCP`、`LCP`、`CLS`、`TTFB` 等，那么我们在实际项目中如何采集到它们呢？

## 指标采集方案

### Performance API

`Performance` 是浏览器提供的原生 API，我们可以使用 `window.performance` 采集性能数据。

```js
window.addEventListener('load', () => {
  const performance = window.performance;
  const timing = performance.timing;

  const metrics = {
    whiteScreenTime: timing.domLoading - timing.navigationStart,  // 白屏时间
    firstScreenTime: performance.getEntriesByName('first-contentful-paint')[0]?.startTime || 0,  // 首屏（FCP）
    domReady: timing.domContentLoadedEventEnd - timing.navigationStart,
    pageLoad: timing.loadEventEnd - timing.navigationStart,
    // 其他指标通过 performance.getEntriesByType('paint') 或 MutationObserver 采集
  };

  // 上报到服务器
  navigator.sendBeacon('/api/performance', JSON.stringify(metrics));
});
```

### MutationObserver

### Web Vitals

先在项目中安装下 `web-vitals` 库。

```bash
npm install web-vitals -S
```

```js
import { onCLS, onFCP, onLCP, onTTFB } from 'web-vitals';

onCLS(console.log);
onFCP(console.log);
onLCP(console.log);
onTTFB(console.log);
```

打印结果如下：

![图片加载失败](../../../assets/images/performance/web-vitals.png)


## 采样注意点
- 使用 `Performance` 要注意下兼容性问题，在低版本浏览器中需要用 `Date.now()` 手动计时。
- 使用 `Chrome DevTools` 的 `Performance 面板`验证采集准确性。

- 内网通过 `Chrome DevTools` 观察首屏时间，这样导致内外网环境不同，首屏时间受到影响，可能会得出“我们网站的首屏时间没问题” 这样的错误结论。
- 使用的是调试工具，跟用户的访问方式不同。
- 测试机观察首屏时间的手机只有几种，而真实用户的机型种类有非常多。


如何了解用户的首屏时间？

大量用户的首屏时间分布是怎么样的？

性能差的用户首屏时间是多少？

