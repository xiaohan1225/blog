import{_ as l,c as a,o as e,ae as p}from"./chunks/framework.CvsoPZUE.js";const _=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"note/performance/17.横向对比：百度、阿里云、美团性能方案对比.md","filePath":"note/performance/17.横向对比：百度、阿里云、美团性能方案对比.md"}'),t={name:"note/performance/17.横向对比：百度、阿里云、美团性能方案对比.md"};function s(r,i,n,o,d,h){return e(),a("div",null,[...i[0]||(i[0]=[p('<h2 id="引言" tabindex="-1">引言 <a class="header-anchor" href="#引言" aria-label="Permalink to &quot;引言&quot;">​</a></h2><p>业界是什么样的情况呢？</p><p>一起来看看百度、阿里云、美团是怎么做的？</p><ul><li>选百度是因为用户要快速搜索到自己想要的内容，这对性能要求非常高。</li><li>阿里云的应用实时监控服务 ARMS 里很重要的一个指标就是性能指标</li><li>美团的外卖到店，履约服务的体验和性能对服务质量影响非常大</li></ul><h2 id="百度" tabindex="-1">百度 <a class="header-anchor" href="#百度" aria-label="Permalink to &quot;百度&quot;">​</a></h2><p>手百前端团队（百度APP前端团队或手机百度前端团队的简称），他们的性能优化整体思路是怎么样的呢？</p><p>手百前端团队一般是先根据QA的专项测试和用户反馈去发现问题，然后定义性能指标，客户端和前端将指标上报，接着使用天幕平台监控预警，分析代码寻求优化解决方案，完成后实施评估。</p><p>性能指标主要以FCP、FMP和卡顿率为主。</p><ul><li>FCP 是指 First Content Paint。表示浏览器内核首次绘制来自DOM的内容，其意义近似于白屏时间，不过是偏向于内容出现的时间，而白屏时间是偏向等待的时间。FCP的侧重点在于第一个字符开始绘制的时刻。</li><li>卡顿率则是指请求中出现卡顿问题的占比。</li></ul><p>指标上报过程中，NA（Native App）和H5都通过各自的埋点 SDK 进行上报，天幕平台根据上报的数据指标，给出平均值、80分位值等，绘制性能报表。</p><p>分析性能报表，找到指标不合理的地方复现问题，进行优化，优化完成后，通过 AB 测试得出性能指标提升，评估体验提升，这样通过长期优化，渐渐达成秒开目标。</p><p>百度搜索前端团队的优化更多借助 NA 能力，对我们的借鉴意义很大。</p><ul><li>webview 初始化耗时 500ms</li><li>Hybrid 初始化大概 100ms，更多是指调起 APP 时，Native 对协议中传入参数的解析及对模版头部和 body 的解析</li><li>正文加载和渲染</li></ul><p>优化方向：</p><ul><li>webview初始化是否可以优化、串行逻辑是否可以并行、渲染速度是否可以提升</li><li>落地方案就是借助 CloudHybrid 和 webview 预创建。</li></ul><p>具体来说，借助 CloudHybrid 方案，采用 SSR + 预加载+ 拦截请求的方式，可以简化页面渲染流程，提前化和并行化网络请求逻辑，进而提升 H5 首屏速度。</p><p>手百团队用了很多 Native 的能力，比如首屏统计、卡顿率统计，好处是手百客户端内的H5页面不需要进行开发就可以全面介入覆盖，缺点是方案依托 NA，升级时需要客户端来发版，另外如果要分享到端外，由于需要H5形式的承接，指标采集和优化就必须有一套对应的解决方案。对此他们依托 sun技术栈来完成，它是一种类似 vue react的mvvm框架，在 sun 框架内部采集性能指标，对于 SSR 方案进行定制化优化。</p><h2 id="阿里云" tabindex="-1">阿里云 <a class="header-anchor" href="#阿里云" aria-label="Permalink to &quot;阿里云&quot;">​</a></h2><p>阿里前端团队尤其是淘系，因为业务场景复杂，在性能方面有很深的造诣，秒开率指标就是这个团队最先提出的。</p><p>整体性能优化思路及常规方案与百度非常类似，都是通过设定性能指标，搭建性能平台，针对监控平台上的数据诊断发现问题，优化完成后看业务数据变化。</p><p>因为阿里云的性能监控方案在体验指标方面非常有特色，业界很多业务都开始上云服务。</p><p>ARMS 性能监控方案是一种通过页面打开速度对 web 场景进行监控，以此来提升站点性能体验的方案，很多阿里系业务都在使用这个方案对性能进行优化。</p><p>这个方案用的是什么性能指标呢？</p><ul><li>定义了一个性能指数 Apdex，用来表示性能体验等级标准，其计算公式为 Apdex = （满意数+可容忍数/2）/总样本数。用白屏时间作为计算指标。</li><li>这是一个总体的指标，除此之外还有首屏时间、秒开率、白屏时间、可交互时间、domReady 时间、Load 时间等指标。</li></ul><p>首屏时间非常重要，着重说一下在 ARMS 性能监控方案中的计算过程：</p><ul><li>首先是通过 mutationObserver 监听页面元素的变化，然后遍历每次新增的元素，计算元素得分总和，如果元素可见得分为1，反之得分为0</li><li>遍历过程采用的是深度优化遍历算法：如果子元素可见，则父元素可见，不用计算，如果最后一个元素可见，则之前兄弟元素可见。</li></ul><p>ARMS 性能监控方案支持 CDN 接入，NPM 包接入两种方式。</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> alife-logger</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --save</span></span></code></pre></div><p>双11会场项目性能问题主要集中在以下几点：</p><ul><li>复杂网路下的问题，尤其是低端 Android 机环境下的问题</li><li>拉新活动时，外部H5调起淘宝 APP 时需要初始化一些组件，从而导致页面体验相对于端内H5差的问题</li><li>会场营销活动页面，因为二次访问率低，缓存数据过期导致的重复渲染和页面元素跳动问题</li></ul><p>具体的优化方案，阿里主要利用数据预加载、缓存和SSR方案来解决。</p><p>阿里的 SSR 方案具有低风险、低成本的特点。</p><ul><li>阿里的SSR提供平滑的自动切换方案，在遇到问题时可以切换到CSR来实现低风险，通过提供统一的 Fass 服务，将前端、客户端和服务端能力结合，可以很方便的低成本接入</li></ul><p>它是怎么做到的呢？</p><ul><li>当页面需要 SSR 渲染时，前端应用使用SSR返回的HTML塞入 root container 中，然后根据模块列表加载模块最终的Hydrate，也就是一个注水的概念形象化描述，将字符串数据变为可用的组件的过程，这就是自动切换方案</li><li>统一的 Fass 服务是指 SSR 渲染后台服务独立出的一个数据服务。在文档服务返回内容保持静态化不变的同时，根据页面提供的模块列表和模块所需数据，将内容动态加载并渲染成 HTML。</li></ul><p>通过该方案，阿里可以将秒开率提高了一个新高度————82.6%。并且在业务指标方面，比如UV点击率方面也有不小的提升，最高达5%。</p><h2 id="美团" tabindex="-1">美团 <a class="header-anchor" href="#美团" aria-label="Permalink to &quot;美团&quot;">​</a></h2><p>美团在前端性能优化方面，会对首屏时间、白屏时间、页面加载完成时间以及流畅度进行检测，进而对白屏时间过长，首屏加载慢和交互体验不一样进行优化。在性能平台上，他们也会给出一些分位值，如tp50、tp90和tp99，对秒开率进行统计。</p><p>美团一般采用的是 Hybrid 开发模式，在这个模式下，美团大前端团队通过 EnhanceHybrid（增强混合方案，一大亮点，对首屏时间贡献最大，具有0白屏时间的称号）方案、SSR 和 离线化技术来进行性能优化。</p><p>EnhanceHybrid 是一个视图切换的预加载方案，主要参考了苹果手机里的视图切换逻辑，当用户点击A的按钮进行B动作时，只有当B的动作完成之后，系统才会让A切换到B，这样有效降低了白屏时间。这个方案重点解决了3个问题：</p><ol><li>无法在跳转B之前完成B的加载和渲染</li><li>无法获取B的渲染速度（进度）</li><li>A等待时间长</li></ol><p>怎么解决的呢？</p><ul><li>用户触发 A 视图到 B 视图的跳转操作后，系统会隐藏式地开启一个新的 webview 网页视图，并展示加载等待动画，此时会展示 B 的加载和渲染进度（注意这个进度只能是模拟的估计）</li><li>当B视图加载完成，首屏内容渲染完成后。客户端通知网页视图，进行B视图的展示，此过程中A等待时间长的问题，可以通过离线化来解决。</li></ul><p>这个方案的好处是，可以直接接入使用，不需要业务前端做什么</p><h2 id="小结" tabindex="-1">小结 <a class="header-anchor" href="#小结" aria-label="Permalink to &quot;小结&quot;">​</a></h2><p>以上就是百度、阿里云、美团的性能优化方案。</p><ul><li>手百属于超级 App，解决了它的性能问题，就解决了大多数场景下的性能问题，所以借助 Native 能力做重性能方案是值得的。</li><li>阿里云提供的服务旨在标准化，不能有太多个性化的统计方案，同时淘宝、天猫双十一会场遇到问题复杂度很高，所以在性能指标采集和SSR方案实现方面要前沿一些。</li><li>美团立足 Hybrid 做了 EnhanceHybrid 方案，低成本，务实的解决了性能问题，挺符合这个公司的文化的</li></ul><p>问题：当下 RN 或者 Flutter 技术很火，为什么不直接用它们，而选择 EnhanceHybrid 方案呢？</p>',48)])])}const c=l(t,[["render",s]]);export{_ as __pageData,c as default};
